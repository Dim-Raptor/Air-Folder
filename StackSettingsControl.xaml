<UserControl x:Class="Air_Folder.StackSettingsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Height="Auto" Width="Auto">
    
    <Grid> 
        <TabControl Margin="10"> 
            <TabItem Header="Основные">
                <StackPanel Margin="10">
                    
                    <!-- Секция: Название стека -->
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/> 
                            <ColumnDefinition Width="*"/>    
                        </Grid.ColumnDefinitions>
                        
                        <Button Grid.Column="0" Width="48" Height="48" Click="OpenBubble_Click" ToolTip="Предпросмотр" BorderBrush="{x:Null}" Background="{x:Null}" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="0,0,5,0">
                            <Image Source="/Assets/preview_stack.ico" />
                        </Button>

                        <StackPanel Grid.Column="1" Margin="0,0,0,0">
                            <TextBlock Text="Название стека:" FontSize="14" Margin="0,0,0,5"/> 
                            <TextBox x:Name="StackNameTextBox" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Height="21" FontSize="13" HorizontalAlignment="Stretch"/> 
                        </StackPanel>
                    </Grid>

                    <!-- Секция: Иконка и Пути -->
                    <DockPanel Margin="0,0,0,10" LastChildFill="True">
                        <Image x:Name="IconPreviewImage" Source="{Binding IconSource}" Width="82" Height="82" Margin="0,0,10,0" 
                               VerticalAlignment="Top" HorizontalAlignment="Left" DockPanel.Dock="Left"/>

                        <StackPanel Margin="0">
                            <!-- Секция: Путь к папке -->
                            <StackPanel Margin="0,0,0,10"> 
                                <TextBlock Text="Папка для стека:" VerticalAlignment="Top" Margin="0,0,0,5"/> 
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/> 
                                        <ColumnDefinition Width="Auto"/> 
                                    </Grid.ColumnDefinitions>
                                    <TextBox Grid.Column="0" x:Name="TargetFolderPathTextBox" Text="{Binding TargetFolderPath, UpdateSourceTrigger=PropertyChanged}" Height="20" HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
                                    <Button Grid.Column="1" Content="Выбрать папку" Width="100" Height="20" Click="SelectFolder_Click" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                </Grid>
                            </StackPanel>

                            <!-- Секция: Выбор иконки -->
                            <StackPanel>
                                <TextBlock Text="Иконка:" VerticalAlignment="Top" Margin="0,0,0,5"/> 
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/> 
                                        <ColumnDefinition Width="Auto"/> 
                                    </Grid.ColumnDefinitions>
                                    <TextBox Grid.Column="0" x:Name="IconPathTextBox" Text="{Binding IconPath, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" Height="20" HorizontalAlignment="Stretch" VerticalAlignment="Center"/>
                                    <Button Grid.Column="1" Content="Выбрать иконку" Width="100" Height="20" VerticalAlignment="Center" Click="SelectIcon_Click" HorizontalAlignment="Right" Margin="5,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </DockPanel>

                    <!-- Секция: Позиция открытия пузыря -->
                    <TextBlock Text="Начало стека:" Margin="0,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Top" HorizontalAlignment="Left">
                        <TextBlock Text="X:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox x:Name="PosXTextBox" Text="{Binding PosX, UpdateSourceTrigger=PropertyChanged}" Width="50" Margin="0,0,10,0" Height="20"/>
                        <TextBlock Text="Y:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <TextBox x:Name="PosYTextBox" Text="{Binding PosY, UpdateSourceTrigger=PropertyChanged}" Width="50" Height="20"/>
                        
                        <!-- НОВАЯ КНОПКА: Указать в системе -->
                        <Button Width="32" Height="32" Click="SetPositionInSystem_Click" ToolTip="Указать в системе" 
                                BorderBrush="{x:Null}" Background="{x:Null}" Margin="10,0,0,0">
                            <Image Source="/Assets/point_stack.ico" />
                        </Button>
                        <ComboBox x:Name="DirectionComboBox"
                                  Width="65"
                                  Height="25"
                                  VerticalAlignment="Center"
                                  Margin="5"
                                  ToolTip="Направление открытия от выбранного начала стека."
                                  SelectedValue="{Binding OpeningDirection}" 
                                  SelectedValuePath="Content">
                            <ComboBoxItem Content="справа"/>
                            <ComboBoxItem Content="слева"/>
                            <ComboBoxItem Content="сверху"/>
                            <ComboBoxItem Content="снизу"/>
                        </ComboBox>
                    </StackPanel>

                    <!-- Кнопки действия -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,0">
                        <Button Content="Создать ярлык" Width="100" Margin="0,0,228,0" HorizontalAlignment="Left">
                            <!-- Отступ справа от этой кнопки -->
                            <Button.ToolTip>
                                <ToolTip>
                                    Создаёт ярлык на рабочем столе или в папке программы "Stacks"
                                </ToolTip>
                            </Button.ToolTip>
                            <Button.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="На рабочем столе" Click="CreateDesktopShortcut_Click"/>
                                    <MenuItem Header="В папке Air Folder" Click="CreateProgramFolderShortcut_Click"/>
                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>
                        <Button Content="Отмена" Width="100" Click="Cancel_Click" Margin="0,0,10,0" HorizontalAlignment="Right"/> 
                        <Button Content="Сохранить стек" Width="100" Click="SaveStack_Click" HorizontalAlignment="Right"/>
                    </StackPanel>
                </StackPanel>
            </TabItem>

            <TabItem Header="Визуальные настройки">
                <StackPanel Margin="10"> 
                    <!-- Кнопка Предпросмотр -->
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/> 
                            <ColumnDefinition Width="*"/>    
                        </Grid.ColumnDefinitions>
                        
                        <Button Grid.Column="0" Width="48" Height="48" Click="OpenBubble_Click" ToolTip="Предпросмотр" BorderBrush="{x:Null}" Background="{x:Null}" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="0,0,5,0">
                            <Image Source="/Assets/preview_stack.ico" />
                        </Button>
                        <!-- Название стека (только для чтения, теперь как ToolTip) -->
                        <TextBlock Grid.Column="1" x:Name="ReadOnlyStackNameTextBlock" 
                                   Text="{Binding Name}" FontWeight="Bold" FontSize="14" 
                                   VerticalAlignment="Top" HorizontalAlignment="Left"
                                   ToolTipService.InitialShowDelay="0"> 
                            <TextBlock.ToolTip>
                                <TextBlock>
                                    <Run Text="Название стека" Foreground="#FF4CC2FF" FontWeight="Bold"/>
                                </TextBlock>
                            </TextBlock.ToolTip>
                        </TextBlock>
                    </Grid>
                    
                    <!-- Кнопки действия (дублируются) -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,8,0">
                        <Button Content="Отмена" Width="100" Click="Cancel_Click" Margin="0,0,10,0"/> 
                        <Button Content="Сохранить стек" Width="100" Click="SaveStack_Click"/>
                    </StackPanel>
                </StackPanel>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
